<!DOCTYPE html>
<html>
<head>
    <title>Probando</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
</head>
<body>

<div class="container">
    <h1 class="text-center">FORM DE BÚSQUEDA</h1>
    <hr>

    <div class="row text-center">
        <div class="col">
            <input type="button" class="btn btn-primary" value="CLIENTES" onclick="cambiarTabla('users');">
        </div>

        <div class="col">
            <input type="button" class="btn btn-primary" value="EMPLEADOS" onclick="cambiarTabla('empleados');"><br><br>
            <!-- Input de búsqueda -->
            <input type="text" id="cuadro_buscar" class="form-control" placeholder="Buscar por ID, nombre, apellido o correo...">
        </div>

        <div class="col">
            <input type="button" class="btn btn-primary" value="ADMINISTRADORES" onclick="cambiarTabla('administradores');">
            <br><br>
            <a href="registrar.html" class="btn btn-success">Registrar Nuevo</a>
        </div>
    </div>

    <hr>

    <h2 class="text-center">LISTA DETALLADA</h2>
    <div class="row justify-content-md-center">
        <div class="col-md-8">
            <div id="mostrar_mensaje"></div>
        </div>
    </div>
</div>

<script>
let tablaActual = "users"; // por defecto clientes

// Cambiar tabla activa
function cambiarTabla(tabla){
    tablaActual = tabla;
    buscarUsuarios();
}

// Buscar en vivo
function buscarUsuarios(query = ""){
    $.post("codigo.php", {action: "buscar", tabla: tablaActual, query: query}, function(response){
        $("#mostrar_mensaje").html(response);
    });
}

$(document).ready(function(){

    // Cargar datos iniciales
    buscarUsuarios();

    // Buscar mientras escribe
    $("#cuadro_buscar").on("keyup", function(){
        let valor = $(this).val();
        buscarUsuarios(valor);
    });

    // Guardar cambios con confirmación
    $(document).on("click", ".btn-guardar", function(){
        let fila = $(this).closest("tr");

        let id = fila.find(".id").text();
        let nombre = fila.find(".nombre").text();
        let apellido = fila.find(".apellido").text();
        let correo = fila.find(".correo").text();

        if(confirm("¿Seguro que deseas actualizar este registro?")){
            $.post("codigo.php", {
                action: "actualizar",
                tabla: tablaActual,
                id: id,
                nombre: nombre,
                apellido: apellido,
                correo: correo
            }, function(respuesta){
                alert(respuesta);
                buscarUsuarios($("#cuadro_buscar").val());
            });
        }
    });

});
</script>

</body>
</html>
